{% extends 'base.html' %}

{% block content %}
<h2 class="mb-4 text-xl font-bold">Listado de Estatus Semanales</h2>

<form method="get" class="mb-4 space-x-2">
    <label>Desde: <input type="date" name="fecha_inicio" value="{{ fecha_inicio }}"></label>
    <label>Hasta: <input type="date" name="fecha_fin" value="{{ fecha_fin }}"></label>
    
    <button type="submit" class="px-3 py-1 bg-blue-500 text-white rounded">🔍 Filtrar</button>
    
    <a href="?orden=asc{% if fecha_inicio %}&fecha_inicio={{ fecha_inicio }}{% endif %}{% if fecha_fin %}&fecha_fin={{ fecha_fin }}{% endif %}" class="px-3 py-1 bg-gray-200 rounded">📈 Orden Ascendente</a>
    
    <a href="?orden=desc{% if fecha_inicio %}&fecha_inicio={{ fecha_inicio }}{% endif %}{% if fecha_fin %}&fecha_fin={{ fecha_fin }}{% endif %}" class="px-3 py-1 bg-gray-200 rounded">📉 Orden Descendente</a>
    
    <button type="submit" name="exportar" value="1" class="px-3 py-1 bg-green-600 text-white rounded">⬇ Exportar a Excel</button>
</form>

<table class="w-full border border-gray-300">
    <thead class="bg-gray-100">
        <tr>
            <th class="px-2 py-1 border">Fecha</th>
            <th class="px-2 py-1 border">Código</th>
            <th class="px-2 py-1 border">Proyecto</th>
            <th class="px-2 py-1 border">Prioridad</th>
            <th class="px-2 py-1 border">Jefe</th>
            <th class="px-2 py-1 border">EECC</th>
            <th class="px-2 py-1 border">Servicio</th>
            <th class="px-2 py-1 border">Autor</th>
            <th class="px-2 py-1 border">Comentario</th>
        </tr>
    </thead>
    <tbody>
        {% for e in estatus %}
        <tr>
            <td class="border px-2 py-1">{{ e.fecha }}</td>
            <td class="border px-2 py-1">{{ e.codigo_proyecto }}</td>
            <td class="border px-2 py-1">{{ e.proyecto }}</td>
            <td class="border px-2 py-1">{{ e.prioridad }}</td>
            <td class="border px-2 py-1">{{ e.jefe_proyecto }}</td>
            <td class="border px-2 py-1">{{ e.eecc }}</td>
            <td class="border px-2 py-1">{{ e.servicio }}</td>
            <td class="border px-2 py-1">{{ e.autor }}</td>
            <td class="border px-2 py-1 whitespace-pre-line">{{ e.comentario }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="9" class="text-center py-4">No hay estatus para mostrar.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
